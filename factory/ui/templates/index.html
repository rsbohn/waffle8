<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Waffle Factory Control Room</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
  </head>
  <body>
    <header class="app-header">
      <h1>Waffle Factory Control Room</h1>
      <p class="tagline">Monitor the PDP-8 and keep the irons humming.</p>
    </header>

    <main class="layout">
      <section class="card" id="execution-controls">
        <h2>Execution</h2>
        <div class="button-group">
          <button type="button" class="button" data-action="reset">Reset</button>
          <button type="button" class="button" data-action="step">Step</button>
          <button type="button" class="button button--primary" data-action="run">Run</button>
          <button type="button" class="button" data-action="halt">Halt</button>
        </div>
        <label class="input-label" for="cycle-count">Cycle budget</label>
        <input type="number" id="cycle-count" name="cycles" min="1" max="100000" value="1024" />
        <div class="status-block" id="execution-status" aria-live="polite"></div>
      </section>

      <section class="card" id="registers">
        <h2>Registers</h2>
        <div class="register-strip" aria-live="polite">
          <div class="register-item">
            <span class="register-label">PC</span>
            <span class="register-value" id="reg-pc">0000</span>
          </div>
          <div class="register-item">
            <span class="register-label">Link</span>
            <span class="register-value" id="reg-link">0</span>
          </div>
          <div class="register-item">
            <span class="register-label">AC</span>
            <span class="register-value" id="reg-ac">0000</span>
          </div>
        </div>
        <div class="register-strip">
          <div class="register-item">
            <span class="register-label">Halt</span>
            <span class="register-value" id="reg-halt" data-state="running">RUN</span>
          </div>
          <div class="register-item">
            <span class="register-label">Switch</span>
            <span class="register-value" id="reg-switch">0000</span>
          </div>
        </div>
        <button type="button" class="button button--secondary" data-action="refresh-registers">
          Refresh
        </button>
      </section>

      <section class="card card--stacked" id="console-output">
        <h2>Console</h2>
        <pre id="teleprinter-log" class="log-window" aria-live="polite"></pre>
        <div class="input-row">
          <input type="text" id="teleprinter-input" maxlength="64" />
          <button type="button" class="button" data-action="send-input">Send</button>
        </div>
      </section>

      <section class="card card--stacked" id="line-printer">
        <h2>Line Printer</h2>
        <pre id="printer-log" class="log-window" aria-live="polite"></pre>
      </section>

      <section class="card" id="rom-loader">
        <h2>ROM Loader</h2>
        <p>Paste a Motorola S-record into the buffer and upload it to memory.</p>
        <form id="rom-form">
          <label class="input-label" for="rom-text">S-record data</label>
          <textarea id="rom-text" name="rom" rows="10" spellcheck="false" placeholder="S00600004844521B&#10;S113000000000000000000000000000000000000C4&#10;S5030000FA"></textarea>
          <button type="submit" class="button button--primary">Upload</button>
          <p class="hint">Whitespace is ignored; a JMP I 20 reset vector is still injected automatically.</p>
        </form>
        <div class="status-block" id="rom-status" aria-live="polite"></div>
      </section>
    </main>

    <footer class="app-footer">
      <small>&copy; {{ current_year }} Waffle Factory Research Lab</small>
    </footer>

    <script defer src="{{ url_for('static', filename='js/app.js') }}"></script>
  </body>
</html>
